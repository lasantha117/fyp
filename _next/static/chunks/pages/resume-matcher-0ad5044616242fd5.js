(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[328],{1402:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var s=a(7876),r=a(4232),n=a(1040),o=a(1237);a(1912);var l=a(5940),i=a(9917),c=a(9099);a(5538);var d=a(4239);function m(){let[e,t]=(0,r.useState)([]),[a,m]=(0,r.useState)(""),[p,u]=(0,r.useState)({}),[b,h]=(0,r.useState)({}),[x,g]=(0,r.useState)([]),[y,f]=(0,r.useState)(!0),[j,_]=(0,r.useState)(null),[N,w]=(0,r.useState)(null),[D,v]=(0,r.useState)(""),J=(0,i.xI)(),I=(0,c.useRouter)();(0,r.useEffect)(()=>{let e=(0,i.hg)(J,async e=>{if(e){_(e);let t=(0,l.C3)(),a=(0,l.KR)(t,"users/".concat(e.uid,"/role")),s=await (0,l.Jt)(a);s.exists()?w(s.val()):w(null)}else _(null),w(null)});return()=>e()},[J,I]),(0,r.useEffect)(()=>{let e=(0,l.C3)(),t=(0,l.KR)(e,"jobs");f(!0);let a=(0,l.Zy)(t,e=>{let t=e.val();t?g(Object.keys(t).map(e=>({Job_ID:e,companyUserId:t[e].companyUserId||"",Job_Title:t[e].Job_Title||"Untitled Job",Company_Name:t[e].Company_Name||"Unknown Company",Job_Description:t[e].Job_Description||"No description provided.",Required_Skills:t[e].Required_Skills||"",Education_Level:t[e].Education_Level||"",Experience_Required:t[e].Experience_Required||"",Location:t[e].Location||"",Job_URL:t[e].Job_URL||"",Source:t[e].Source||"Firebase",...t[e]}))):g([]),f(!1)},e=>{console.error("Error fetching jobs from Firebase:",e),m("\uD83D\uDEAB Error fetching job vacancies. Please check console for details."),f(!1)});return()=>a()},[]);let S=(0,r.useCallback)(async e=>new Promise((t,a)=>{let s=new FileReader;s.onload=async s=>{let r=s.target.result;if("text/plain"===e.type)t(new TextDecoder("utf-8").decode(r));else{let s=new FormData;s.append("resumes",e),s.append("job_description","dummy");try{let e=await n.A.post("http://localhost:5000/api/matcher",s,{headers:{"Content-Type":"multipart/form-data"}});e.data&&e.data.results&&e.data.results.length>0?t(e.data.results[0].text):a(Error("Failed to extract text from file via backend."))}catch(e){a(Error("Backend extraction error: ".concat(e.message)))}}},s.onerror=e=>a(e),s.readAsArrayBuffer(e)}),[]),C=async t=>{if(t.preventDefault(),!j||"candidate"!==N){m("⚠️ Please log in as a candidate to match resumes.");return}if(0===e.length){m("⚠️ Please upload at least one resume.");return}m("\uD83D\uDD0D Matching resumes to all job vacancies. Please wait..."),u({});let a={};try{let t=e[0],s=await S(t);for(let e of(v(s),x)){if(!e.Job_ID||!e.Job_Title||!e.Job_Description){console.warn("Skipping job with missing critical data for matching: ".concat(e.Job_ID||"Unknown ID"));continue}let s=new FormData;s.append("resumes",t),s.append("job_description",e.Job_Description);let r=await n.A.post("http://localhost:5000/api/matcher",s,{headers:{"Content-Type":"multipart/form-data"}});r.data&&r.data.results&&(a[e.Job_ID]=r.data.results.map(t=>({...t,jobTitle:e.Job_Title,company:e.Company_Name,jobDescription:e.Job_Description,companyUserId:e.companyUserId,jobUrl:e.Job_URL,source:e.Source,showKeywords:!1})))}h(a),m("")}catch(e){console.error("Error matching resumes:",e),m("\uD83D\uDEAB Error matching resumes. Please ensure the backend is running and accessible.")}},U=async t=>{if(!j||"candidate"!==N){u(e=>({...e,[t.Job_ID]:{text:"⚠️ Please log in as a candidate to apply for jobs.",type:"danger"}}));return}if(0===e.length){u(e=>({...e,[t.Job_ID]:{text:"⚠️ Please upload your resume first before applying.",type:"danger"}}));return}let a=e[0];if(!a){u(e=>({...e,[t.Job_ID]:{text:"⚠️ Resume file not found. Please re-upload your resume.",type:"danger"}}));return}if("Firebase"===t.Source&&!t.companyUserId){u(e=>({...e,[t.Job_ID]:{text:"\uD83D\uDEAB Cannot apply: This job from Firebase has incomplete data (missing company ID). Please contact the administrator.",type:"danger"}})),console.error("Attempted to apply to a Firebase job with missing companyUserId:",t);return}if(!t.Job_ID||!j.uid||!j.email||!t.Job_Title||!t.Source){u(e=>({...e,[t.Job_ID]:{text:"\uD83D\uDEAB Missing critical data for application. Please ensure job data and user session are complete.",type:"danger"}})),console.error("Missing application data:",{jobId:t.Job_ID,companyUserId:t.companyUserId,candidateUserId:j.uid,candidateEmail:j.email,jobTitle:t.Job_Title,jobUrl:t.Job_URL,jobSource:t.Source});return}u(e=>({...e,[t.Job_ID]:{text:"Submitting application for ".concat(t.Job_Title,"..."),type:"info"}}));try{let e=b[t.Job_ID],s=e&&e.length>0?e[0].match_percentage:0,r=new FormData;r.append("resume_file",a),r.append("jobId",t.Job_ID),r.append("companyUserId",t.companyUserId||""),r.append("candidateUserId",j.uid),r.append("candidateEmail",j.email),r.append("jobTitle",t.Job_Title),r.append("jobUrl",t.Job_URL||""),r.append("jobSource",t.Source),r.append("matchPercentage",s.toString());let o=await n.A.post("http://localhost:5000/api/apply",r,{headers:{"Content-Type":"multipart/form-data"}});o.data&&o.data.message?u(e=>({...e,[t.Job_ID]:{text:"✅ ".concat(o.data.message),type:"success"}})):u(e=>({...e,[t.Job_ID]:{text:"Application submitted, but no confirmation message received.",type:"info"}}))}catch(e){console.error("Error submitting application:",e),u(a=>{var s,r;return{...a,[t.Job_ID]:{text:"\uD83D\uDEAB Failed to submit application: ".concat((null===(r=e.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.message)||e.message),type:"danger"}}})}finally{setTimeout(()=>{u(e=>{let a={...e};return delete a[t.Job_ID],a})},5e3)}},k=e=>b[e]||[];return(0,s.jsx)("div",{className:"container mt-5",children:(0,s.jsxs)("div",{className:"card shadow rounded-2xl",children:[(0,s.jsx)("div",{className:"card-header bg-primary text-white p-4 rounded-t-2xl",children:(0,s.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-0",children:"Resume Matcher Against All Job Vacancies"}),(0,s.jsx)("button",{className:"btn btn-secondary btn-sm",onClick:()=>I.push("/candidate-dashboard"),children:"Back to Dashboard"})]})}),(0,s.jsxs)("div",{className:"card-body p-4",children:[(0,s.jsxs)("form",{onSubmit:C,className:"mb-4",children:[(0,s.jsxs)("div",{className:"form-group mb-3",children:[(0,s.jsx)("label",{htmlFor:"resumes",className:"form-label text-gray-700 font-medium",children:"Upload Resumes"}),(0,s.jsx)("input",{type:"file",className:"form-control form-control-lg border rounded-lg p-2",id:"resumes",multiple:!1,accept:".pdf,.docx,.txt",onChange:e=>{t(Array.from(e.target.files)),m(""),h({}),v(""),u({})}})]}),(0,s.jsx)("button",{type:"submit",className:"btn btn-success me-3 px-4 py-2 rounded-full shadow-md hover:bg-green-600 transition duration-300",disabled:0===e.length||!j||"candidate"!==N,children:j&&"candidate"===N?"Match Resume":"Login as Candidate to Match"}),(0,s.jsx)("button",{type:"button",className:"btn btn-secondary px-4 py-2 rounded-full shadow-md hover:bg-gray-600 transition duration-300",onClick:()=>{t([]),h({}),m(""),u({}),v(""),document.getElementById("resumes").value=null},children:"Clear Results"})]}),a&&(0,s.jsx)("div",{className:"alert ".concat(a.includes("Error")||a.includes("\uD83D\uDEAB")||a.includes("⚠️")?"alert-danger":"alert-info"," mt-3 p-3 rounded-lg"),children:a}),(0,s.jsxs)("div",{className:"mt-5",children:[(0,s.jsx)("h4",{className:"text-xl font-semibold text-gray-800 mb-4",children:"\uD83D\uDCC4 All Available Vacancies"}),y?(0,s.jsx)("p",{className:"text-center text-muted",children:"Loading job vacancies..."}):0===x.length?(0,s.jsx)("p",{className:"text-center text-gray-500",children:"No job vacancies available."}):x.map(e=>{let t=k(e.Job_ID),a=t[0];return{job:e,matchResults:t,percentage:a?Math.round(a.match_percentage):0}}).sort((e,t)=>t.percentage-e.percentage).map((t,a)=>{let{job:r,matchResults:n}=t,l=j&&"candidate"===N&&e.length>0,i="Firebase"===r.Source&&!r.companyUserId,c=p[r.Job_ID];return(0,s.jsxs)("div",{className:"border rounded-2xl p-4 mb-4 shadow-md bg-white",children:[(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsx)("strong",{className:"text-gray-800",children:"Job Title:"})," ",r.Job_Title]}),(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsx)("strong",{className:"text-gray-800",children:"Company:"})," ",r.Company_Name]}),(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsx)("strong",{className:"text-gray-800",children:"Description:"})," ",r.Job_Description]}),(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsx)("strong",{className:"text-gray-800",children:"Skills:"})," ",r.Required_Skills||"N/A"]}),(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsx)("strong",{className:"text-gray-800",children:"Education:"})," ",r.Education_Level||"N/A"]}),(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsx)("strong",{className:"text-gray-800",children:"Experience:"})," ",r.Experience_Required||"N/A"]}),(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsx)("strong",{className:"text-gray-800",children:"Location:"})," ",r.Location||"N/A"]}),r.Source&&"Firebase"!==r.Source&&(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsx)("strong",{className:"text-gray-800",children:"Source:"})," ",r.Source]}),r.Job_URL&&(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsx)("strong",{className:"text-gray-800",children:"Job Link:"})," ",(0,s.jsx)("a",{href:r.Job_URL,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"View Job"})]}),n.length>0&&n.map((e,t)=>{let a=Math.min(100,Math.max(0,Math.round(e.match_percentage)));return(0,s.jsxs)("div",{className:"mt-4 border-t pt-3 border-gray-200",children:[(0,s.jsxs)("p",{className:"text-md font-medium text-gray-700",children:[(0,s.jsx)("strong",{children:"Matched Resume:"})," ",e.filename]}),(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{style:{width:100,height:100},children:(0,s.jsx)(o.QF,{value:a,text:"".concat(a,"%"),styles:(0,o.Hf)({pathColor:"#2ecc71",textColor:"#000",trailColor:"#eee",textSize:"18px"})})}),(0,s.jsx)("button",{className:"btn btn-outline-dark mt-3 px-4 py-2 rounded-full shadow-sm hover:bg-gray-100 transition duration-300",onClick:()=>{h(e=>{let a={...e},s=a[r.Job_ID];return s&&s[t]&&(s[t].showKeywords=!s[t].showKeywords),a})},children:e.showKeywords?"Hide Matched Words":"Show Matched Words"}),e.showKeywords&&(0,s.jsx)("div",{className:"mt-2 w-full",children:(0,s.jsx)(d.A,{jobDescription:r.Job_Description,resumes:[e]})})]})]},t)}),(0,s.jsx)("div",{className:"flex flex-col items-center mt-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("button",{className:"btn btn-primary px-6 py-2 rounded-full shadow-md hover:bg-blue-700 transition duration-300",onClick:()=>U(r),disabled:!l||i,children:j&&"candidate"===N?i?"Cannot Apply (Job Data Incomplete)":"Apply Now":"Login as Candidate to Apply"}),i&&(0,s.jsx)("p",{className:"text-danger text-sm mt-2",children:"This job has incomplete data and cannot be applied to."}),c&&(0,s.jsx)("div",{className:"alert alert-".concat(c.type," mt-2 text-sm text-center"),role:"alert",children:c.text})]})})]},r.Job_ID)})]})]})]})})}},4239:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var s=a(7876);function r(e){let{jobDescription:t,resumes:a}=e,r=(e,t)=>{let a=new Set(e.toLowerCase().split(/\W+/).filter(e=>e.length>0)),s=new Set(t.toLowerCase().split(/\W+/).filter(e=>e.length>0));return[...a].filter(e=>s.has(e)&&e.length>3)};return(0,s.jsxs)("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg shadow-inner",children:[(0,s.jsx)("h6",{className:"text-lg font-semibold text-gray-700 mb-3",children:"\uD83D\uDD0D Matching Keywords:"}),a.map((e,a)=>(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsxs)("p",{className:"text-md font-medium text-gray-600",children:["Resume: ",(0,s.jsx)("span",{className:"font-normal",children:e.filename})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:r(t,e.text).length>0?r(t,e.text).map((e,t)=>(0,s.jsx)("span",{className:"px-3 py-1 bg-green-200 text-green-800 rounded-full text-sm font-medium shadow-sm",children:e},t)):(0,s.jsx)("span",{className:"text-gray-500 text-sm",children:"No significant matching keywords found."})})]},a))]})}a(4232)},5538:(e,t,a)=>{"use strict";var s=a(6042),r=a(5940),n=a(9917),o=a(5226);let l=(0,s.Wp)({apiKey:"AIzaSyDfp_Ya2eIUMFRg0Ub1ICsgvKqPMoWk4lM",authDomain:"fyp-bbe4d.firebaseapp.com",databaseURL:"https://fyp-bbe4d-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"fyp-bbe4d",storageBucket:"fyp-bbe4d.firebasestorage.app",messagingSenderId:"75697914820",appId:"1:75697914820:web:7bab142f2d6313cf1c1a91"});(0,r.C3)(l),(0,n.xI)(l),(0,o.c7)(l)},7484:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/resume-matcher",function(){return a(1402)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[7,166,3,149,636,593,792],()=>t(7484)),_N_E=e.O()}]);