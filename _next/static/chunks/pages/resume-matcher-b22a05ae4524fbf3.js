(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[328],{1402:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>m});var s=t(7876),r=t(4232),n=t(1040),o=t(1237);t(1912);var l=t(5940),c=t(9917),i=t(9099);t(5538);var d=t(4239);function m(){let[e,a]=(0,r.useState)(""),[t,m]=(0,r.useState)({}),[p,u]=(0,r.useState)({}),[b,h]=(0,r.useState)([]),[x,g]=(0,r.useState)(!0),[y,f]=(0,r.useState)(null),[j,_]=(0,r.useState)(null),[N,w]=(0,r.useState)(null),v=(0,c.xI)(),D=(0,i.useRouter)();(0,r.useEffect)(()=>{let e=(0,c.hg)(v,async e=>{if(e){f(e);let a=(0,l.C3)(),t=(0,l.KR)(a,"users/".concat(e.uid,"/role")),s=await (0,l.Jt)(t);s.exists()?_(s.val()):_(null)}else f(null),_(null),D.push("/login")});return()=>e()},[v,D]),(0,r.useEffect)(()=>{let e=(0,l.C3)(),t=(0,l.KR)(e,"jobs");g(!0);let s=(0,l.Zy)(t,e=>{let a=e.val();a?h(Object.keys(a).map(e=>({Job_ID:e,companyUserId:a[e].companyUserId||"",Job_Title:a[e].Job_Title||"Untitled Job",Company_Name:a[e].Company_Name||"Unknown Company",Job_Description:a[e].Job_Description||"No description provided.",Required_Skills:a[e].Required_Skills||"",Education_Level:a[e].Education_Level||"",Experience_Required:a[e].Experience_Required||"",Location:a[e].Location||"",Job_URL:a[e].Job_URL||"",Source:a[e].Source||"Firebase",...a[e]}))):h([]),g(!1)},e=>{console.error("Error fetching jobs from Firebase:",e),a("\uD83D\uDEAB Error fetching job vacancies. Please check console for details."),g(!1)});return()=>s()},[]);let I=(0,r.useCallback)(async e=>new Promise((a,t)=>{let s=new FileReader;s.onload=async s=>{let r=s.target.result;if("text/plain"===e.type)a(new TextDecoder("utf-8").decode(r));else{let s=new FormData;s.append("resumes",e),s.append("job_description","dummy");try{let e=await n.A.post("http://localhost:5000/api/matcher",s,{headers:{"Content-Type":"multipart/form-data"}});e.data&&e.data.results&&e.data.results.length>0?a(e.data.results[0].text):t(Error("Failed to extract text from file via backend."))}catch(e){t(Error("Backend extraction error: ".concat(e.message)))}}},s.onerror=e=>t(e),s.readAsArrayBuffer(e)}),[]),J=async e=>{if(e.preventDefault(),!y||"candidate"!==j){a("⚠️ Please log in as a candidate to match resumes.");return}if(!N){a("⚠️ Please upload a resume file.");return}if(0===b.length){a("ℹ️ No job vacancies available to match against.");return}a("\uD83D\uDD0D Matching your resume to all job vacancies. Please wait..."),m({});try{let e=await I(N),t=await n.A.post("http://localhost:5000/api/get_all_matched_jobs",{resume_text:e,jobList:b});if(t.data&&t.data.results){let s={};t.data.results.forEach(a=>{s[a.Job_ID]=[{filename:N.name,text:e,match_percentage:a.match_percentage,matched_keywords:a.matching_words,jobTitle:a.Job_Title,company:a.Company_Name,jobDescription:a.Job_Description,jobUrl:a.Job_URL,source:a.Source,companyUserId:a.companyUserId,showKeywords:!1}]}),u(s),a("✅ Matching complete!")}else a("No matching results found or an error occurred during matching.")}catch(e){var t,s;console.error("Error matching resumes:",e),a("\uD83D\uDEAB Error matching resumes: ".concat((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||e.message,". Please ensure the backend is running and accessible."))}},S=async e=>{if(!y||"candidate"!==j){m(a=>({...a,[e.Job_ID]:{text:"⚠️ Please log in as a candidate to apply for jobs.",type:"danger"}}));return}if(!N){m(a=>({...a,[e.Job_ID]:{text:"⚠️ Please upload your resume first before applying.",type:"danger"}}));return}if("Firebase"===e.Source&&!e.companyUserId){m(a=>({...a,[e.Job_ID]:{text:"\uD83D\uDEAB Cannot apply: This job from Firebase has incomplete data (missing company ID). Please contact the administrator.",type:"danger"}})),console.error("Attempted to apply to a Firebase job with missing companyUserId:",e);return}if(!e.Job_ID||!y.uid||!y.email||!N||!e.Job_Title||!e.Source){m(a=>({...a,[e.Job_ID]:{text:"\uD83D\uDEAB Missing critical data for application. Please ensure job data and user session are complete.",type:"danger"}})),console.error("Missing application data:",{jobId:e.Job_ID,companyUserId:e.companyUserId,candidateUserId:y.uid,candidateEmail:y.email,jobTitle:e.Job_Title,jobUrl:e.Job_URL,jobSource:e.Source,resumeFile:N.name});return}m(a=>({...a,[e.Job_ID]:{text:"Submitting application for ".concat(e.Job_Title,"..."),type:"info"}}));try{let a=p[e.Job_ID],t=a&&a.length>0?a[0].match_percentage:0,s=new FormData;s.append("resume_file",N),s.append("jobId",e.Job_ID),s.append("companyUserId",e.companyUserId||""),s.append("candidateUserId",y.uid),s.append("candidateEmail",y.email),s.append("jobTitle",e.Job_Title),s.append("jobUrl",e.Job_URL||""),s.append("jobSource",e.Source),s.append("matchPercentage",t.toString());let r=await n.A.post("http://localhost:5000/api/apply",s,{headers:{"Content-Type":"multipart/form-data"}});r.data&&r.data.message?m(a=>({...a,[e.Job_ID]:{text:"✅ ".concat(r.data.message),type:"success"}})):m(a=>({...a,[e.Job_ID]:{text:"Application submitted, but no confirmation message received.",type:"info"}}))}catch(a){console.error("Error submitting application:",a),m(t=>{var s,r;return{...t,[e.Job_ID]:{text:"\uD83D\uDEAB Failed to submit application: ".concat((null===(r=a.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.message)||a.message),type:"danger"}}})}finally{setTimeout(()=>{m(a=>{let t={...a};return delete t[e.Job_ID],t})},5e3)}};return(0,s.jsx)("div",{className:"container mt-5",children:(0,s.jsxs)("div",{className:"card shadow rounded-2xl",children:[(0,s.jsx)("div",{className:"card-header bg-primary text-white p-4 rounded-t-2xl",children:(0,s.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-0",children:"Resume Matcher Against All Job Vacancies"}),(0,s.jsx)("button",{className:"btn btn-secondary btn-sm",onClick:()=>D.push("/candidate-dashboard"),children:"Back to Dashboard"})]})}),(0,s.jsxs)("div",{className:"card-body p-4",children:[(0,s.jsxs)("form",{onSubmit:J,className:"mb-4",children:[(0,s.jsxs)("div",{className:"form-group mb-3",children:[(0,s.jsx)("label",{htmlFor:"resumes",className:"form-label text-gray-700 font-medium",children:"Upload Resume (PDF, DOCX, TXT)"}),(0,s.jsx)("input",{type:"file",className:"form-control form-control-lg border rounded-lg p-2",id:"resumes",multiple:!1,accept:".pdf,.docx,.txt",onChange:e=>{w(e.target.files[0]||null),a(""),u({}),m({})}}),N&&(0,s.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["Selected file: ",(0,s.jsx)("span",{className:"font-semibold",children:N.name})]})]}),(0,s.jsx)("button",{type:"submit",className:"btn btn-success me-3 px-4 py-2 rounded-full shadow-md hover:bg-green-600 transition duration-300",disabled:!N||!y||"candidate"!==j||0===b.length,children:y&&"candidate"===j?"Match Resume":"Login as Candidate to Match"}),(0,s.jsx)("button",{type:"button",className:"btn btn-secondary px-4 py-2 rounded-full shadow-md hover:bg-gray-600 transition duration-300",onClick:()=>{w(null),u({}),a(""),m({}),document.getElementById("resumes").value=null},children:"Clear Results"})]}),e&&(0,s.jsx)("div",{className:"alert ".concat(e.includes("Error")||e.includes("\uD83D\uDEAB")||e.includes("⚠️")?"alert-danger":"alert-info"," mt-3 p-3 rounded-lg"),children:e}),(0,s.jsxs)("div",{className:"mt-5",children:[(0,s.jsx)("h4",{className:"text-xl font-semibold text-gray-800 mb-4",children:"\uD83D\uDCC4 All Available Vacancies"}),x?(0,s.jsx)("p",{className:"text-center text-muted",children:"Loading job vacancies..."}):0===b.length?(0,s.jsx)("p",{className:"text-center text-gray-500",children:"No job vacancies available."}):b.map(e=>{let a=p[e.Job_ID]?p[e.Job_ID][0]:null,t=a?Math.min(100,Math.max(0,Math.round(a.match_percentage))):0,s=a?a.matching_words:[],r=!!a&&a.showKeywords;return{...e,match_percentage:t,matching_words:s,showKeywords:r}}).sort((e,a)=>a.match_percentage-e.match_percentage).map(e=>{let a=e.match_percentage,r=y&&"candidate"===j&&N,n="Firebase"===e.Source&&!e.companyUserId,l=t[e.Job_ID];return(0,s.jsxs)("div",{className:"border rounded-2xl p-4 mb-4 shadow-md bg-white",children:[(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsx)("strong",{className:"text-gray-800",children:"Job Title:"})," ",e.Job_Title]}),(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsx)("strong",{className:"text-gray-800",children:"Company:"})," ",e.Company_Name]}),(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsx)("strong",{className:"text-gray-800",children:"Description:"})," ",e.Job_Description]}),(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsx)("strong",{className:"text-gray-800",children:"Skills:"})," ",e.Required_Skills||"N/A"]}),(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsx)("strong",{className:"text-gray-800",children:"Education:"})," ",e.Education_Level||"N/A"]}),(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsx)("strong",{className:"text-gray-800",children:"Experience:"})," ",e.Experience_Required||"N/A"]}),(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsx)("strong",{className:"text-gray-800",children:"Location:"})," ",e.Location||"N/A"]}),e.Source&&"Firebase"!==e.Source&&(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsx)("strong",{className:"text-gray-800",children:"Source:"})," ",e.Source]}),e.Job_URL&&(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsx)("strong",{className:"text-gray-800",children:"Job Link:"})," ",(0,s.jsx)("a",{href:e.Job_URL,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"View Job"})]}),Object.keys(p).length>0&&(0,s.jsxs)("div",{className:"mt-4 border-t pt-3 border-gray-200",children:[(0,s.jsx)("p",{className:"text-md font-medium text-gray-700",children:(0,s.jsx)("strong",{children:"Match Percentage:"})}),(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{style:{width:100,height:100},children:(0,s.jsx)(o.QF,{value:a,text:"".concat(a,"%"),styles:(0,o.Hf)({pathColor:a>75?"#2ecc71":a>50?"#f39c12":"#e74c3c",textColor:"#000",trailColor:"#eee",textSize:"18px"})})}),e.matching_words&&e.matching_words.length>0&&(0,s.jsx)("button",{className:"btn btn-outline-dark mt-3 px-4 py-2 rounded-full shadow-sm hover:bg-gray-100 transition duration-300",onClick:()=>{u(a=>{let t={...a};return t[e.Job_ID]&&t[e.Job_ID][0]&&(t[e.Job_ID][0].showKeywords=!t[e.Job_ID][0].showKeywords),{...t}})},children:e.showKeywords?"Hide Matched Words":"Show Matched Words"}),e.showKeywords&&(0,s.jsx)("div",{className:"mt-2 w-full",children:(0,s.jsx)(d.A,{job:e})})]})]}),(0,s.jsx)("div",{className:"flex flex-col items-center mt-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("button",{className:"btn btn-primary px-6 py-2 rounded-full shadow-md hover:bg-blue-700 transition duration-300",onClick:()=>S(e),disabled:!r||n,children:y&&"candidate"===j?n?"Cannot Apply (Job Data Incomplete)":"Apply Now":"Login as Candidate to Apply"}),n&&(0,s.jsx)("p",{className:"text-danger text-sm mt-2",children:"This job has incomplete data and cannot be applied to."}),l&&(0,s.jsx)("div",{className:"alert alert-".concat(l.type," mt-2 text-sm text-center"),role:"alert",children:l.text})]})})]},e.Job_ID)})]})]})]})})}},4239:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});var s=t(7876);function r(e){let{job:a}=e;if(!a||!a.matching_words)return console.warn("MatchingKeywords received undefined job or matching_words prop."),null;let{filename:t,matching_words:r}=a;return(0,s.jsxs)("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg shadow-inner",children:[(0,s.jsx)("h6",{className:"text-lg font-semibold text-gray-700 mb-3",children:"\uD83D\uDD0D Matching Keywords:"}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsxs)("p",{className:"text-md font-medium text-gray-600",children:["Resume: ",(0,s.jsx)("span",{className:"font-normal",children:t||"N/A"})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:r.length>0?r.map((e,a)=>(0,s.jsx)("span",{className:"px-3 py-1 bg-green-200 text-green-800 rounded-full text-sm font-medium shadow-sm",children:e},a)):(0,s.jsx)("span",{className:"text-gray-500 text-sm",children:"No significant matching keywords found."})})]})]})}t(4232)},5538:(e,a,t)=>{"use strict";var s=t(6042),r=t(5940),n=t(9917),o=t(5226);let l=(0,s.Wp)({apiKey:"AIzaSyDfp_Ya2eIUMFRg0Ub1ICsgvKqPMoWk4lM",authDomain:"fyp-bbe4d.firebaseapp.com",databaseURL:"https://fyp-bbe4d-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"fyp-bbe4d",storageBucket:"fyp-bbe4d.firebasestorage.app",messagingSenderId:"75697914820",appId:"1:75697914820:web:7bab142f2d6313cf1c1a91"});(0,r.C3)(l),(0,n.xI)(l),(0,o.c7)(l)},7484:(e,a,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/resume-matcher",function(){return t(1402)}])}},e=>{var a=a=>e(e.s=a);e.O(0,[7,166,3,149,636,593,792],()=>a(7484)),_N_E=e.O()}]);